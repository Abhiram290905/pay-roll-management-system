DELIMITER $$ 
 
CREATE TRIGGER trg_set_default_status 
BEFORE INSERT ON payroll 
FOR EACH ROW 
BEGIN 
IF NEW.status IS NULL THEN 
SET NEW.status = 'Pending'; 
END IF; 
END$$ 
 
DELIMITER ; 
INSERT INTO payroll (date, net_salary, employee_id) 
VALUES ('2025-03-30', 39000, 16);


CREATE TRIGGER trg_prevent_duplicate_attendance 
BEFORE INSERT ON attendance 
FOR EACH ROW 
BEGIN 
IF EXISTS ( 
SELECT 1 FROM attendance 
WHERE employee_id = NEW.employee_id AND date = NEW.date 
) THEN 
SIGNAL SQLSTATE '45000â€™ 
SET MESSAGE_TEXT = 'Attendance already recorded for this date.'; 
END IF; 
END$$ 
 
DELIMITER ; 
INSERT INTO attendance (date, status, employee_id) 
VALUES ('2025-04-07', 'Present', 14); 
INSERT INTO attendance (date, status, employee_id) 
VALUES ('2025-04-07', 'Present', 14);

 
DELIMITER $$ 
 
CREATE TRIGGER trg_check_overtime_hours 
BEFORE INSERT ON overtime 
FOR EACH ROW 
BEGIN 
16  
IF NEW.hours_worked > 24 THEN 
SIGNAL SQLSTATE '45000' 
SET MESSAGE_TEXT = 'Overtime hours cannot exceed 24 in a day'; 
END IF; 
END$$ 
 
DELIMITER ; 
INSERT INTO overtime (hours_worked, overtime_pay, employee_id) VALUES (30, 5000, 17); 

DELIMITER $$ 
 
CREATE TRIGGER trg_block_duplicate_monthly_payroll 
BEFORE INSERT ON payroll 
FOR EACH ROW 
BEGIN 
IF EXISTS ( 
SELECT 1 FROM payroll 
WHERE employee_id = NEW.employee_id 
AND MONTH(date) = MONTH(NEW.date) 
AND YEAR(date) = YEAR(NEW.date) 
) THEN 
SIGNAL SQLSTATE '45000' 
SET MESSAGE_TEXT = 'Payroll already exists for this employee in this month'; 
END IF; 
END$$ 
 
DELIMITER ; 
INSERT INTO payroll (date, net_salary, employee_id) 
VALUES ('2025-03-20', 40000, 1); 
INSERT INTO payroll (date, net_salary, employee_id) 
VALUES ('2025-02-20', 40000, 1);



 
DELIMITER $$ 
17  
CREATE TRIGGER trg_calculate_net_salary 
BEFORE INSERT ON payroll 
FOR EACH ROW 
BEGIN 
DECLARE ot DECIMAL(10,2); 
DECLARE ded DECIMAL(10,2); 
 
SELECT COALESCE(overtime_pay, 0) INTO ot FROM overtime WHERE employee_id = 
NEW.employee_id; 
SELECT COALESCE(tax + amount, 0) INTO ded FROM deductions WHERE employee_id = 
NEW.employee_id; 
 
SET NEW.net_salary = NEW.net_salary + ot - ded; 
END$$ 
 
DELIMITER ; 
INSERT INTO employee (first_name, last_name, phone_no, DOB, department_id, supervisor_id) 
VALUES ('Ajay', 'Devgan', '9988776655', '1990-01-01', 5, 5); 
INSERT INTO overtime (hours_worked, overtime_pay, employee_id) 
VALUES (5, 1000, 21); 
INSERT INTO deductions (tax, amount, employee_id) 
VALUES (1200, 800, 21); 
INSERT INTO payroll (date, net_salary, employee_id) 
VALUES ('2025-03-31', 30000, 21); 
SELECT * FROM payroll WHERE employee_id = 21;
